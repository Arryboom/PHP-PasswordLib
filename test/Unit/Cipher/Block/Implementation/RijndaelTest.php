<?php

class Unit_Cipher_Block_Implementation_RijndaelTest extends PHPUnit_Framework_TestCase {

    /**
     * @return array The test vectors
     */
    public static function provideTestEncryptVectors() {
        $ret = array(
            array(
                'rijndael-128',
                '8000000000000000000000000000000000000000000000000000000000000000', 
                '00000000000000000000000000000000', 
                'E35A6DCB19B201A01EBCFA8AA22B5759'
            ),
            array(
                'rijndael-128',
                '4000000000000000000000000000000000000000000000000000000000000000',
                '00000000000000000000000000000000',
                '5075C2405B76F22F553488CAE47CE90B'
            ),
            array(
                'rijndael-128',
                '2000000000000000000000000000000000000000000000000000000000000000',
                '00000000000000000000000000000000',
                '49DF95D844A0145A7DE01C91793302D3'
            ),
            array(
                'rijndael-128',
                '1000000000000000000000000000000000000000000000000000000000000000',
                '00000000000000000000000000000000',
                'E7396D778E940B8418A86120E5F421FE'
            ),
            array(
                'rijndael-128',
                '0800000000000000000000000000000000000000000000000000000000000000',
                '00000000000000000000000000000000',
                '05F535C36FCEDE4657BE37F4087DB1EF'
            ),
            array(
                'rijndael-128',
                '0400000000000000000000000000000000000000000000000000000000000000',
                '00000000000000000000000000000000',
                'D0C1DDDD10DA777C68AB36AF51F2C204'
            ),
            array(
                'rijndael-128',
                '0200000000000000000000000000000000000000000000000000000000000000',
                '00000000000000000000000000000000',
                '1C55FB811B5C6464C4E5DE1535A75514'
            ),
            array(
                'rijndael-128',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '80000000000000000000000000000000',
                'DDC6BF790C15760D8D9AEB6F9A75FD4E'
            ),
            array(
                'rijndael-128',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '40000000000000000000000000000000',
                'C7098C217C334D0C9BDF37EA13B0822C'
            ),
            array(
                'rijndael-128',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '20000000000000000000000000000000',
                '60F0FB0D4C56A8D4EEFEC5264204042D'
            ),
            array(
                'rijndael-128',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '10000000000000000000000000000000',
                '73376FBBF654D0686E0E84001477106B'
            ),
            array(
                'rijndael-128',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '08000000000000000000000000000000',
                '2F443B52BA5F0C6EA0602C7C4FD259B6'
            ),
            array(
                'rijndael-128',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '04000000000000000000000000000000',
                '75D11B0E3A68C4223D88DBF017977DD7'
            ),
            array(
                'rijndael-128',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '00000000000000000000000000000000',
                'DC95C078A2408989AD48A21492842087'
            ),
            array(
                'rijndael-128',
                '0101010101010101010101010101010101010101010101010101010101010101',
                '01010101010101010101010101010101',
                '9CAC94C6B48561F8FFAAA78616BA4892'
            ),
            array(
                'rijndael-128',
                '000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F',
                '00112233445566778899AABBCCDDEEFF',
                '8EA2B7CA516745BFEAFC49904B496089',
            ),
            array(
                'rijndael-192',
                '8000000000000000000000000000000000000000000000000000000000000000',
                '000000000000000000000000000000000000000000000000',
                '06EB844DEC23F29F029BE85FDCE578CEC5C663CE0C70403C',
            ),
            array(
                'rijndael-192',
                '4000000000000000000000000000000000000000000000000000000000000000',
                '000000000000000000000000000000000000000000000000',
                '8DB2BBBD69D4470F6E9FC0658E219BFF05C0F93C510D99D3',
            ),
            array(
                'rijndael-192',
                '2000000000000000000000000000000000000000000000000000000000000000',
                '000000000000000000000000000000000000000000000000',
                'EEB0DAA865958FF4387A0F3E28249F3211974438DDA1FE55',
            ),
            array(
                'rijndael-192',
                '1000000000000000000000000000000000000000000000000000000000000000',
                '000000000000000000000000000000000000000000000000',
                'D1E57047BB578392E6A3EC416C8EF46C7EF942EA9D62912E',
            ),
            array(
                'rijndael-192',
                '0800000000000000000000000000000000000000000000000000000000000000',
                '000000000000000000000000000000000000000000000000',
                '90C5E47E1983834633F9B769602038F66E67123B630C1CA0',
            ),
            array(
                'rijndael-192',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '800000000000000000000000000000000000000000000000',
                'D5ABE078FFD84B955DD1296B5B55FCAEE61A4149B3126274',
            ),
            array(
                'rijndael-192',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '400000000000000000000000000000000000000000000000',
                '4C75599812D9D9EA9DF46C22060AEDF09C335EF8AEC66BD7',
            ),
            array(
                'rijndael-192',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '200000000000000000000000000000000000000000000000',
                '589F6A6BA500D8D5598595957D66922328B6A9E0D744ECC0',
            ),
            array(
                'rijndael-192',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '100000000000000000000000000000000000000000000000',
                'F281C3FAED9FF92F6E44F98B2D67AC1F011C86AF1E4D6096',
            ),
            array(
                'rijndael-192',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '080000000000000000000000000000000000000000000000',
                'BCBCC6ED79CE1013FD0338F05445D5BFE5C61D38378F217F',
            ),
            array(
                'rijndael-192',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '000000000000000000000000000000000000000000000000',
                '17004E806FAEF168FC9CD56F98F070982075C70C8132B945',
            ),
            array(
                'rijndael-192',
                '0101010101010101010101010101010101010101010101010101010101010101',
                '010101010101010101010101010101010101010101010101',
                '18C0C2C37C137075749352EBEC999F7C52D0E64CF15C3AF5'
            ),
            array(
                'rijndael-192',
                '0202020202020202020202020202020202020202020202020202020202020202',
                '020202020202020202020202020202020202020202020202',
                'DD4EC8525C77187197DF4C5A4F065A08C583CBF51C21E16A'
            ),
            array(
                'rijndael-192',
                '0303030303030303030303030303030303030303030303030303030303030303',
                '030303030303030303030303030303030303030303030303',
                'A7637E9211120FBE8934674E3E180C6691291424D8AA32FD'
            ),
            array(
                'rijndael-192',
                '0404040404040404040404040404040404040404040404040404040404040404',
                '040404040404040404040404040404040404040404040404',
                '7EEAA622930B7DB8DCA0D0987BCDCC13DBF79367D16ACF58'
            ),
            array(
                'rijndael-192',
                '000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F',
                '00112233445566778899AABBCCDDEEFF1021324354657687',
                '65D851DF8D04B5CBB510935FDD1EB17B33EFB8CB255EE712'
            ),
            array(
                'rijndael-192',
                '2BD6459F82C5B300952C49104881FF482BD6459F82C5B300952C49104881FF48',
                'EA024714AD5C4D84EA024714AD5C4D84EA024714AD5C4D84',
                '26DE14F04653486BEA4F3CB31B11A3C1DFC5EEBC00756D38'
            ),
            array(
                'rijndael-256',
                '8000000000000000000000000000000000000000000000000000000000000000',
                '0000000000000000000000000000000000000000000000000000000000000000',
                'E62ABCE069837B65309BE4EDA2C0E149FE56C07B7082D3287F592C4A4927A277',
            ),
            array(
                'rijndael-256',
                '4000000000000000000000000000000000000000000000000000000000000000',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '1F00B4DD622C0B2951F25970B0ED47A65F513112DACA242B5292CA314917BF94',
            ),
            array(
                'rijndael-256',
                '2000000000000000000000000000000000000000000000000000000000000000',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '2AA9F4BE159F9F8777561281C1CC4FCD7435E6E855E222426C309838ABD5FFEE',
            ),
            array(
                'rijndael-256',
                '1000000000000000000000000000000000000000000000000000000000000000',
                '0000000000000000000000000000000000000000000000000000000000000000',
                'B4ADF28C3A85C337AA3150E3032B941AA49F12F911221DD91A62919CAD447CFB',
            ),
            array(
                'rijndael-256',
                '0800000000000000000000000000000000000000000000000000000000000000',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '99FEC55D4AE12B7A92636089D78C63223431C76DFEC0C6681AF8CF7FC13F6F19',
            ),
            array(
                'rijndael-256',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '8000000000000000000000000000000000000000000000000000000000000000',
                '159A08E46E616E6E9978502010DAFF922EB362E77DCAAF02EAEB7354EB8B8DBA',
            ),
            array(
                'rijndael-256',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '4000000000000000000000000000000000000000000000000000000000000000',
                '2756DDECD7558B198962F092D7BA3EEF45D9E287380AAB8E852658092AA9DFA1',
            ),
            array(
                'rijndael-256',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '2000000000000000000000000000000000000000000000000000000000000000',
                '87B829FB7B0C16C408151D323FCB8B56EBC0573747D46C2B47BFD533ED3273C9',
            ),
            array(
                'rijndael-256',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '1000000000000000000000000000000000000000000000000000000000000000',
                'DB462EEC713D4CC89607DCA35C4FE6E8D618C8BDACD3DD1C0A1B14E6CA8C23C6',
            ),
            array(
                'rijndael-256',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '0800000000000000000000000000000000000000000000000000000000000000',
                'D5229B0958734C47A8BF379EE9C028C14A979404948665FBE55D284765E17549',
            ),
            array(
                'rijndael-256',
                '0000000000000000000000000000000000000000000000000000000000000000',
                '0000000000000000000000000000000000000000000000000000000000000000',
                'C6227E7740B7E53B5CB77865278EAB0726F62366D9AABAD908936123A1FC8AF3',
            ),
            array(
                'rijndael-256',
                '0101010101010101010101010101010101010101010101010101010101010101',
                '0101010101010101010101010101010101010101010101010101010101010101',
                'F6F97C6772F20488E3C0EEC5482981B2BD00B15BBDF940069FBF5142CEB39688',
            ),
            array(
                'rijndael-256',
                '0202020202020202020202020202020202020202020202020202020202020202',
                '0202020202020202020202020202020202020202020202020202020202020202',
                'F86F8B6B6AECB4353F4D44B1FFE376D039B0297AC7417E8E47CDD96E6DD816E7',
            ),
            array(
                'rijndael-256',
                '0303030303030303030303030303030303030303030303030303030303030303',
                '0303030303030303030303030303030303030303030303030303030303030303',
                'DDD552EFC6B7175B14B15BE2B0CA178A6F1E9AA9DBA1E9FFA95B5C5936B7E348',
            ),
            array(
                'rijndael-256',
                '0404040404040404040404040404040404040404040404040404040404040404',
                '0404040404040404040404040404040404040404040404040404040404040404',
                '9BCAC5743C175D1231E091113F38AADEC78F51597DD71D68CDB791C4E11E8DD2',
            ),
            array(
                'rijndael-256',
                '000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F',
                '00112233445566778899AABBCCDDEEFF102132435465768798A9BACBDCEDFE0F',
                '288FA9D23D00D9DC0A39B33FA92867C6488B5E0F18A6F74C072078EC815462E6',
            ),
            array(
                'rijndael-256',
                '2BD6459F82C5B300952C49104881FF482BD6459F82C5B300952C49104881FF48',
                'EA024714AD5C4D84EA024714AD5C4D84EA024714AD5C4D84EA024714AD5C4D84',
                '9FBB6A7A59A42DA9B5B807A618A73BADFDC89AE3C80AB53ED6C0723918443A62',
            ),
        );
        return $ret;
    }

    /**
     * @dataProvider provideTestEncryptVectors
     */
    public function testEncrypt($cipher, $key, $data, $expected) {
        $cipher = new \CryptLib\Cipher\Block\Implementation\Rijndael($cipher);
        $enc = $cipher->encryptBlock(pack('H*', $data), pack('H*', $key));
        $this->assertEquals($expected, strtoupper(bin2hex($enc)));
    }
    
    /**
     * @dataProvider provideTestEncryptVectors
     */
    public function testDecrypt($cipher, $key, $expected, $data) {
        $cipher = new \CryptLib\Cipher\Block\Implementation\Rijndael($cipher);
        $enc = $cipher->decryptBlock(pack('H*', $data), pack('H*', $key));
        $this->assertEquals($expected, strtoupper(bin2hex($enc)));
    }
    
    /**
     * @dataProvider provideTestEncryptVectors
     */
    public function testEncryptThenDecrypt($cipher, $key, $data) {
        $cipher = new \CryptLib\Cipher\Block\Implementation\Rijndael($cipher);
        $enc = $cipher->encryptBlock(pack('H*', $data), pack('H*', $key));
        $dec = $cipher->decryptBlock($enc, pack('H*', $key));
        $this->assertEquals($data, strtoupper(bin2hex($dec)));
    }
    
    public function testBlockSize() {
        $cipher = new \CryptLib\Cipher\Block\Implementation\Rijndael('rijndael-128');
        $this->assertEquals(16, $cipher->getBlockSize('foo'));
        $cipher = new \CryptLib\Cipher\Block\Implementation\Rijndael('rijndael-256');
        $this->assertEquals(32, $cipher->getBlockSize('foo'));
    }
    
    public function testGetCipher() {
        $cipher = new \CryptLib\Cipher\Block\Implementation\Rijndael('rijndael-128');
        $this->assertEquals('rijndael-128', $cipher->getCipher());
    }

}
